<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Officer Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
</head>
<body class="dashboard-body">
  <nav class="navbar">
    <div class="nav-title">Scheduler App - Officer</div>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </nav>

  <main class="dashboard-container">
    <h1 id="welcome-text">Welcome!</h1>

    <div class="dashboard-section">
      <button class="action-btn" onclick="showSchedule()">View My Schedule</button>
      <button class="action-btn" onclick="showAssignedSite()">Assigned Site Info</button>
    </div>

    <!-- Display areas -->
    <div id="scheduleList" class="dashboard-section" style="display: none;"></div>
    <div id="siteInfo" class="dashboard-section" style="display: none;"></div>
  </main>

  <script>
    window.onload = function () {
      const user = JSON.parse(localStorage.getItem("user"));

      if (!user || user.role !== "officer") {
        window.location.href = "login.html";
        return;
      }

      // Show first name
      if (user.fullName) {
        const firstName = user.fullName.split(" ")[0];
        document.getElementById("welcome-text").textContent = `Welcome, ${firstName}!`;
      }
    };

    function logout() {
      localStorage.removeItem("user");
      window.location.href = "login.html";
    }

    function showSchedule() {
      const user = JSON.parse(localStorage.getItem("user"));
      const schedules = JSON.parse(localStorage.getItem("schedules")) || [];
      const scheduleList = document.getElementById("scheduleList");
      const siteInfoDiv = document.getElementById("siteInfo");

      // Hide other section
      siteInfoDiv.style.display = "none";

      // Clear previous
      scheduleList.innerHTML = "";

      const officerSchedules = schedules.filter(
        s => s.officerEmail?.toLowerCase() === user.email.toLowerCase()
      );

      if (officerSchedules.length === 0) {
        scheduleList.innerHTML = "<p>No assigned schedules found.</p>";
      } else {
        officerSchedules.forEach((s, i) => {
          const div = document.createElement("div");
          div.className = "schedule-card";
          div.innerHTML = `
            <strong>Schedule ${i + 1}</strong><br>
            <strong>Site:</strong> ${s.site}<br>
            <strong>Date:</strong> ${s.date}<br>
            <strong>Time:</strong> ${s.startTime}<br>
            <strong>Supervisor:</strong> ${s.supervisorName || "N/A"}<br>
          `;
          scheduleList.appendChild(div);
        });
      }

      scheduleList.style.display = "block";
    }

    function showAssignedSite() {
      const user = JSON.parse(localStorage.getItem("user"));
      const schedules = JSON.parse(localStorage.getItem("schedules")) || [];
      const siteInfoDiv = document.getElementById("siteInfo");
      const scheduleList = document.getElementById("scheduleList");

      // Hide other section
      scheduleList.style.display = "none";

      siteInfoDiv.innerHTML = "";

      const assigned = schedules.filter(
        s => s.officerEmail?.toLowerCase() === user.email.toLowerCase()
      );

      if (assigned.length === 0) {
        siteInfoDiv.innerHTML = "<p>No site assignment found.</p>";
      } else {
        let html = "<h3>Assigned Site Info</h3><ul>";
        assigned.forEach(s => {
          html += `<li>
            <strong>Site:</strong> ${s.site}<br>
            <strong>Date:</strong> ${s.date}<br>
            <strong>Time:</strong> ${s.startTime}<br>
            <strong>Supervisor:</strong> ${s.supervisorName || "N/A"}
          </li><br>`;
        });
        html += "</ul>";
        siteInfoDiv.innerHTML = html;
      }

      siteInfoDiv.style.display = "block";
    }
  </script>
</body>
</html>
